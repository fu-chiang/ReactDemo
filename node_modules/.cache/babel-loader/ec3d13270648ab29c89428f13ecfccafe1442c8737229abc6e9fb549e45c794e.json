{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useRef,useState,useContext}from'react';import axios from\"axios\";import CouponModal from\"../../components/CouponModal\";import DeleteModal from\"../../components/DeleteModal\";import Pagination from\"../../components/Pagination\";import{Modal}from\"bootstrap\";import{MessageContext,handleSuccessMessage,handleErrorMessage}from'../../store/messageStore';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AdminCoupons(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),coupons=_useState2[0],setCoupons=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),pagination=_useState4[0],setPagination=_useState4[1];// type: 決定 modal 展開的用途\nvar _useState5=useState('create'),_useState6=_slicedToArray(_useState5,2),type=_useState6[0],setType=_useState6[1];// edit\nvar _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),tempCoupon=_useState8[0],setTempCoupon=_useState8[1];var _useContext=useContext(MessageContext),_useContext2=_slicedToArray(_useContext,2),dispatch=_useContext2[1];var couponModal=useRef(null);var deleteModal=useRef(null);useEffect(function(){couponModal.current=new Modal('#productModal',{backdrop:'static'});deleteModal.current=new Modal('#deleteModal',{backdrop:'static'});getCoupons();},[]);var getCoupons=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var page,res,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:page=_args.length>0&&_args[0]!==undefined?_args[0]:1;_context.next=3;return axios.get(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/coupons?page=\").concat(page));case 3:res=_context.sent;console.log(res);setCoupons(res.data.coupons);setPagination(res.data.pagination);case 7:case\"end\":return _context.stop();}},_callee);}));return function getCoupons(){return _ref.apply(this,arguments);};}();var openCouponModal=function openCouponModal(type,item){setType(type);setTempCoupon(item);couponModal.current.show();};var closeModal=function closeModal(){couponModal.current.hide();};var openDeleteModal=function openDeleteModal(product){setTempCoupon(product);deleteModal.current.show();};var closeDeleteModal=function closeDeleteModal(){deleteModal.current.hide();};var deleteCoupon=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(id){var res;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.delete(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/coupon/\").concat(id));case 3:res=_context2.sent;if(res.data.success){getCoupons();handleSuccessMessage(dispatch,res);deleteModal.current.hide();}_context2.next=11;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);handleErrorMessage(dispatch,_context2.t0);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,7]]);}));return function deleteCoupon(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"p-3\",children:[/*#__PURE__*/_jsx(CouponModal,{closeModal:closeModal,getCoupons:getCoupons,tempCoupon:tempCoupon,type:type}),/*#__PURE__*/_jsx(DeleteModal,{close:closeDeleteModal,text:tempCoupon.title,handleDelete:deleteCoupon,id:tempCoupon.id}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u512A\\u60E0\\u5238\\u5217\\u8868\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"text-end\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:function onClick(){return openCouponModal('create',{});},children:\"\\u5EFA\\u7ACB\\u65B0\\u512A\\u60E0\\u5238\"})}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u6A19\\u984C\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u6298\\u6263\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u5230\\u671F\\u65E5\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u512A\\u60E0\\u78BC\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u555F\\u7528\\u72C0\\u614B\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u7DE8\\u8F2F\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:coupons.map(function(product){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:product.title}),/*#__PURE__*/_jsx(\"td\",{children:product.percent}),/*#__PURE__*/_jsx(\"td\",{children:new Date(product.due_date).toDateString()}),/*#__PURE__*/_jsx(\"td\",{children:product.code}),/*#__PURE__*/_jsx(\"td\",{children:product.is_enabled?'啟用':'未啟用'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:function onClick(){return openCouponModal('edit',product);},children:\"\\u7DE8\\u8F2F\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-outline-danger btn-sm ms-2\",onClick:function onClick(){return openDeleteModal(product);},children:\"\\u522A\\u9664\"})]})]},product.id);})})]}),/*#__PURE__*/_jsx(Pagination,{pagination:pagination,changePage:getCoupons})]});}export default AdminCoupons;","map":{"version":3,"names":["useEffect","useRef","useState","useContext","axios","CouponModal","DeleteModal","Pagination","Modal","MessageContext","handleSuccessMessage","handleErrorMessage","AdminCoupons","coupons","setCoupons","pagination","setPagination","type","setType","tempCoupon","setTempCoupon","dispatch","couponModal","deleteModal","current","backdrop","getCoupons","page","get","process","env","REACT_APP_API_PATH","res","console","log","data","openCouponModal","item","show","closeModal","hide","openDeleteModal","product","closeDeleteModal","deleteCoupon","id","delete","success","title","map","percent","Date","due_date","toDateString","code","is_enabled"],"sources":["C:/Users/A3423/Desktop/Project/react-cra/src/pages/admin/AdminCoupons.js"],"sourcesContent":["import { useEffect, useRef, useState, useContext } from 'react';\nimport axios from \"axios\";\nimport CouponModal from \"../../components/CouponModal\";\nimport DeleteModal from \"../../components/DeleteModal\";\nimport Pagination from \"../../components/Pagination\";\nimport { Modal } from \"bootstrap\";\nimport {\n  MessageContext,\n  handleSuccessMessage,\n  handleErrorMessage,\n} from '../../store/messageStore';\n\nfunction AdminCoupons() {\n  const [coupons, setCoupons] = useState([]);\n  const [pagination, setPagination] = useState({});\n  // type: 決定 modal 展開的用途\n  const [type, setType] = useState('create'); // edit\n  const [tempCoupon, setTempCoupon] = useState({});\n  const [, dispatch] = useContext(MessageContext);\n\n  const couponModal = useRef(null);\n  const deleteModal = useRef(null);\n  useEffect(() => {\n    couponModal.current = new Modal('#productModal', {\n      backdrop: 'static',\n    });\n    deleteModal.current = new Modal('#deleteModal', {\n      backdrop: 'static',\n    });\n\n    getCoupons();\n  }, []);\n\n  const getCoupons = async (page = 1) => {\n    const res = await axios.get(\n      `/v2/api/${process.env.REACT_APP_API_PATH}/admin/coupons?page=${page}`,\n    );\n    console.log(res);\n    setCoupons(res.data.coupons);\n    setPagination(res.data.pagination);\n  }\n\n  const openCouponModal = (type, item) => {\n    setType(type);\n    setTempCoupon(item);\n    couponModal.current.show();\n  }\n  const closeModal = () => {\n    couponModal.current.hide();\n  }\n\n  const openDeleteModal = (product) => {\n    setTempCoupon(product);\n    deleteModal.current.show();\n  };\n  const closeDeleteModal = () => {\n    deleteModal.current.hide();\n  };\n  const deleteCoupon = async (id) => {\n    try {\n      const res = await axios.delete(`/v2/api/${process.env.REACT_APP_API_PATH}/admin/coupon/${id}`);\n      if (res.data.success) {\n        getCoupons();\n        handleSuccessMessage(dispatch, res);\n        deleteModal.current.hide();\n      }\n    } catch (error) {\n      console.log(error);\n      handleErrorMessage(dispatch, error);\n    }\n  }\n\n  return (\n    <div className='p-3'>\n      <CouponModal\n        closeModal={closeModal}\n        getCoupons={getCoupons}\n        tempCoupon={tempCoupon}\n        type={type}\n      />\n      <DeleteModal\n        close={closeDeleteModal}\n        text={tempCoupon.title}\n        handleDelete={deleteCoupon}\n        id={tempCoupon.id}\n      />\n      <h3>優惠券列表</h3>\n      <hr />\n      <div className='text-end'>\n        <button\n          type='button'\n          className='btn btn-primary btn-sm'\n          onClick={() => openCouponModal('create', {})}\n        >\n          建立新優惠券\n        </button>\n      </div>\n      <table className='table'>\n        <thead>\n          <tr>\n            <th scope='col'>標題</th>\n            <th scope='col'>折扣</th>\n            <th scope='col'>到期日</th>\n            <th scope='col'>優惠碼</th>\n            <th scope='col'>啟用狀態</th>\n            <th scope='col'>編輯</th>\n          </tr>\n        </thead>\n        <tbody>\n          {coupons.map((product) => {\n            return (\n              <tr key={product.id}>\n                <td>{product.title}</td>\n                <td>{product.percent}</td>\n                <td>{new Date(product.due_date).toDateString()}</td>\n                <td>{product.code}</td>\n                <td>{product.is_enabled ? '啟用' : '未啟用'}</td>\n                <td>\n                  <button\n                    type='button'\n                    className='btn btn-primary btn-sm'\n                    onClick={() => openCouponModal('edit', product)}\n                  >\n                    編輯\n                  </button>\n                  <button\n                    type='button'\n                    className='btn btn-outline-danger btn-sm ms-2'\n                    onClick={() => openDeleteModal(product)}\n                  >\n                    刪除\n                  </button>\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n      <Pagination pagination={pagination} changePage={getCoupons} />\n    </div>\n  );\n}\n\nexport default AdminCoupons;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}