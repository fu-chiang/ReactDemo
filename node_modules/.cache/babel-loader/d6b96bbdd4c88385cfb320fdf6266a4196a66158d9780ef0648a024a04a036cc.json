{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useEffect,useRef,useState,useContext}from'react';import axios from\"axios\";import ProductModal from\"../../components/ProductModal\";import DeleteModal from\"../../components/DeleteModal\";import Pagination from\"../../components/Pagination\";import{Modal}from\"bootstrap\";import{MessageContext,handleSuccessMessage,handleErrorMessage}from'../../store/messageStore';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function AdminProducts(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),products=_useState2[0],setProducts=_useState2[1];var _useState3=useState({}),_useState4=_slicedToArray(_useState3,2),pagination=_useState4[0],setPagination=_useState4[1];// type: 決定 modal 展開的用途\nvar _useState5=useState('create'),_useState6=_slicedToArray(_useState5,2),type=_useState6[0],setType=_useState6[1];// edit\nvar _useState7=useState({}),_useState8=_slicedToArray(_useState7,2),tempProduct=_useState8[0],setTempProduct=_useState8[1];var _useContext=useContext(MessageContext),_useContext2=_slicedToArray(_useContext,2),dispatch=_useContext2[1];var productModal=useRef(null);var deleteModal=useRef(null);useEffect(function(){productModal.current=new Modal('#productModal',{backdrop:'static'});deleteModal.current=new Modal('#deleteModal',{backdrop:'static'});getProducts();},[]);var getProducts=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var page,productRes,_args=arguments;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:page=_args.length>0&&_args[0]!==undefined?_args[0]:1;_context.next=3;return axios.get(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/products?page=\").concat(page));case 3:productRes=_context.sent;console.log(productRes);setProducts(productRes.data.products);setPagination(productRes.data.pagination);case 7:case\"end\":return _context.stop();}},_callee);}));return function getProducts(){return _ref.apply(this,arguments);};}();var openProductModal=function openProductModal(type,product){setType(type);setTempProduct(product);productModal.current.show();};var closeProductModal=function closeProductModal(){productModal.current.hide();};var openDeleteModal=function openDeleteModal(product){setTempProduct(product);deleteModal.current.show();};var closeDeleteModal=function closeDeleteModal(){deleteModal.current.hide();};var deleteProduct=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(id){var res;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.delete(\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/product/\").concat(id));case 3:res=_context2.sent;if(res.data.success){getProducts();handleSuccessMessage(dispatch,res);deleteModal.current.hide();}_context2.next=11;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);console.log(_context2.t0);handleErrorMessage(dispatch,_context2.t0);case 11:case\"end\":return _context2.stop();}},_callee2,null,[[0,7]]);}));return function deleteProduct(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"p-3\",children:[/*#__PURE__*/_jsx(ProductModal,{closeProductModal:closeProductModal,getProducts:getProducts,tempProduct:tempProduct,type:type}),/*#__PURE__*/_jsx(DeleteModal,{close:closeDeleteModal,text:tempProduct.title,handleDelete:deleteProduct,id:tempProduct.id}),/*#__PURE__*/_jsx(\"h3\",{children:\"\\u7522\\u54C1\\u5217\\u8868\"}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"text-end\",children:/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:function onClick(){return openProductModal('create',{});},children:\"\\u5EFA\\u7ACB\\u65B0\\u5546\\u54C1\"})}),/*#__PURE__*/_jsxs(\"table\",{className:\"table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u5206\\u985E\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u540D\\u7A31\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u552E\\u50F9\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u555F\\u7528\\u72C0\\u614B\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",children:\"\\u7DE8\\u8F2F\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:products.map(function(product){return/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:product.category}),/*#__PURE__*/_jsx(\"td\",{children:product.title}),/*#__PURE__*/_jsx(\"td\",{children:product.price}),/*#__PURE__*/_jsx(\"td\",{children:product.is_enabled?'啟用':'未啟用'}),/*#__PURE__*/_jsxs(\"td\",{children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary btn-sm\",onClick:function onClick(){return openProductModal('edit',product);},children:\"\\u7DE8\\u8F2F\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-outline-danger btn-sm ms-2\",onClick:function onClick(){return openDeleteModal(product);},children:\"\\u522A\\u9664\"})]})]},product.id);})})]}),/*#__PURE__*/_jsx(Pagination,{pagination:pagination,changePage:getProducts})]});}export default AdminProducts;","map":{"version":3,"names":["useEffect","useRef","useState","useContext","axios","ProductModal","DeleteModal","Pagination","Modal","MessageContext","handleSuccessMessage","handleErrorMessage","AdminProducts","products","setProducts","pagination","setPagination","type","setType","tempProduct","setTempProduct","dispatch","productModal","deleteModal","current","backdrop","getProducts","page","get","process","env","REACT_APP_API_PATH","productRes","console","log","data","openProductModal","product","show","closeProductModal","hide","openDeleteModal","closeDeleteModal","deleteProduct","id","delete","res","success","title","map","category","price","is_enabled"],"sources":["C:/Users/A3423/Desktop/Project/react-cra/src/pages/admin/AdminProducts.js"],"sourcesContent":["import { useEffect, useRef, useState, useContext } from 'react';\nimport axios from \"axios\";\nimport ProductModal from \"../../components/ProductModal\";\nimport DeleteModal from \"../../components/DeleteModal\";\nimport Pagination from \"../../components/Pagination\";\nimport { Modal } from \"bootstrap\";\nimport {\n  MessageContext,\n  handleSuccessMessage,\n  handleErrorMessage,\n} from '../../store/messageStore';\n\nfunction AdminProducts() {\n  const [products, setProducts] = useState([]);\n  const [pagination, setPagination] = useState({});\n  // type: 決定 modal 展開的用途\n  const [type, setType] = useState('create'); // edit\n  const [tempProduct, setTempProduct] = useState({});\n  const [, dispatch] = useContext(MessageContext);\n\n  const productModal = useRef(null);\n  const deleteModal = useRef(null);\n  useEffect(() => {\n    productModal.current = new Modal('#productModal', {\n      backdrop: 'static',\n    });\n    deleteModal.current = new Modal('#deleteModal', {\n      backdrop: 'static',\n    });\n\n    getProducts();\n  }, []);\n\n  const getProducts = async (page = 1) => {\n    const productRes = await axios.get(\n      `/v2/api/${process.env.REACT_APP_API_PATH}/admin/products?page=${page}`,\n    );\n    console.log(productRes);\n    setProducts(productRes.data.products);\n    setPagination(productRes.data.pagination);\n  }\n\n  const openProductModal = (type, product) => {\n    setType(type);\n    setTempProduct(product);\n    productModal.current.show();\n  }\n  const closeProductModal = () => {\n    productModal.current.hide();\n  }\n\n  const openDeleteModal = (product) => {\n    setTempProduct(product);\n    deleteModal.current.show();\n  };\n  const closeDeleteModal = () => {\n    deleteModal.current.hide();\n  };\n  const deleteProduct = async (id) => {\n    try {\n      const res = await axios.delete(`/v2/api/${process.env.REACT_APP_API_PATH}/admin/product/${id}`);\n      if (res.data.success) {\n        getProducts();\n        handleSuccessMessage(dispatch, res);\n        deleteModal.current.hide();\n      }\n    } catch (error) {\n      console.log(error);\n      handleErrorMessage(dispatch, error);\n    }\n  }\n\n  return (\n    <div className='p-3'>\n      <ProductModal\n        closeProductModal={closeProductModal}\n        getProducts={getProducts}\n        tempProduct={tempProduct}\n        type={type}\n      />\n      <DeleteModal\n        close={closeDeleteModal}\n        text={tempProduct.title}\n        handleDelete={deleteProduct}\n        id={tempProduct.id}\n      />\n      <h3>產品列表</h3>\n      <hr />\n      <div className='text-end'>\n        <button\n          type='button'\n          className='btn btn-primary btn-sm'\n          onClick={() => openProductModal('create', {})}\n        >\n          建立新商品\n        </button>\n      </div>\n      <table className='table'>\n        <thead>\n          <tr>\n            <th scope='col'>分類</th>\n            <th scope='col'>名稱</th>\n            <th scope='col'>售價</th>\n            <th scope='col'>啟用狀態</th>\n            <th scope='col'>編輯</th>\n          </tr>\n        </thead>\n        <tbody>\n          {products.map((product) => {\n            return (\n              <tr key={product.id}>\n                <td>{product.category}</td>\n                <td>{product.title}</td>\n                <td>{product.price}</td>\n                <td>{product.is_enabled ? '啟用' : '未啟用'}</td>\n                <td>\n                  <button\n                    type='button'\n                    className='btn btn-primary btn-sm'\n                    onClick={() => openProductModal('edit', product)}\n                  >\n                    編輯\n                  </button>\n                  <button\n                    type='button'\n                    className='btn btn-outline-danger btn-sm ms-2'\n                    onClick={() => openDeleteModal(product)}\n                  >\n                    刪除\n                  </button>\n                </td>\n              </tr>\n            );\n          })}\n        </tbody>\n      </table>\n      <Pagination pagination={pagination} changePage={getProducts} />\n    </div>\n  );\n}\n\nexport default AdminProducts;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}