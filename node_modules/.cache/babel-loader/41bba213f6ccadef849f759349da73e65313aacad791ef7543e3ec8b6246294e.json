{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/A3423/Desktop/Project/react-cra/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import axios from\"axios\";import{useEffect,useState,useContext}from'react';import{MessageContext,handleSuccessMessage,handleErrorMessage}from'../store/messageStore';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function ProductModal(_ref){var closeModal=_ref.closeModal,getCoupons=_ref.getCoupons,type=_ref.type,tempCoupon=_ref.tempCoupon;var _useState=useState({title:'',is_enabled:1,percent:80,due_date:1555459200,code:'testCode'}),_useState2=_slicedToArray(_useState,2),tempData=_useState2[0],setTempData=_useState2[1];var _useState3=useState(new Date()),_useState4=_slicedToArray(_useState3,2),date=_useState4[0],setDate=_useState4[1];var _useContext=useContext(MessageContext),_useContext2=_slicedToArray(_useContext,2),dispatch=_useContext2[1];useEffect(function(){if(type==='create'){setTempData({title:'',is_enabled:1,percent:80,due_date:1555459200,code:'testCode'});setDate(new Date());}else if(type==='edit'){setTempData(tempCoupon);setDate(new Date(tempCoupon.due_date));}},[type,tempCoupon]);var handleChange=function handleChange(e){var _e$target=e.target,value=_e$target.value,name=_e$target.name;if(['price','origin_price'].includes(name)){setTempData(_objectSpread(_objectSpread({},tempData),{},_defineProperty({},name,Number(value))));}else if(name==='is_enabled'){setTempData(_objectSpread(_objectSpread({},tempData),{},_defineProperty({},name,+e.target.checked)));}else{setTempData(_objectSpread(_objectSpread({},tempData),{},_defineProperty({},name,value)));}};var submit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var api,method,res;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;api=\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/coupon\");method='post';if(type==='edit'){api=\"/v2/api/\".concat(process.env.REACT_APP_API_PATH,\"/admin/coupon/\").concat(tempCoupon.id);method='put';}_context.next=6;return axios[method](api,{data:_objectSpread(_objectSpread({},tempData),{},{due_date:date.getTime()// 轉換成 unix timestamp\n})});case 6:res=_context.sent;console.log(res);handleSuccessMessage(dispatch,res);closeModal();getCoupons();_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](0);console.log(_context.t0);handleErrorMessage(dispatch,_context.t0);case 17:case\"end\":return _context.stop();}},_callee,null,[[0,13]]);}));return function submit(){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"modal fade\",tabIndex:\"-1\",id:\"productModal\",\"aria-labelledby\":\"exampleModalLabel\",\"aria-hidden\":\"true\",children:/*#__PURE__*/_jsx(\"div\",{className:\"modal-dialog modal-lg\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"modal-title fs-5\",id:\"exampleModalLabel\",children:type==='create'?'建立新優惠券':\"\\u7DE8\\u8F2F \".concat(tempData.title)}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-close\",\"aria-label\":\"Close\",onClick:closeModal})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-body\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-2\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"w-100\",htmlFor:\"title\",children:[\"\\u6A19\\u984C\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"title\",placeholder:\"\\u8ACB\\u8F38\\u5165\\u6A19\\u984C\",name:\"title\",className:\"form-control mt-1\",value:tempData.title,onChange:handleChange})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 mb-2\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"w-100\",htmlFor:\"percent\",children:[\"\\u6298\\u6263\\uFF08%\\uFF09\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",name:\"percent\",id:\"percent\",placeholder:\"\\u8ACB\\u8F38\\u5165\\u6298\\u6263\\uFF08%\\uFF09\",className:\"form-control mt-1\",value:tempData.percent,onChange:handleChange})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 mb-2\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"w-100\",htmlFor:\"due_date\",children:[\"\\u5230\\u671F\\u65E5\",/*#__PURE__*/_jsx(\"input\",{type:\"date\",id:\"due_date\",name:\"due_date\",placeholder:\"\\u8ACB\\u8F38\\u5165\\u5230\\u671F\\u65E5\",className:\"form-control mt-1\",value:\"\".concat(date.getFullYear().toString(),\"-\").concat((date.getMonth()+1).toString().padStart(2,0),\"-\").concat(date.getDate().toString().padStart(2,0)),onChange:function onChange(e){setDate(new Date(e.target.value));}})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6 mb-2\",children:/*#__PURE__*/_jsxs(\"label\",{className:\"w-100\",htmlFor:\"code\",children:[\"\\u512A\\u60E0\\u78BC\",/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"code\",name:\"code\",placeholder:\"\\u8ACB\\u8F38\\u5165\\u512A\\u60E0\\u78BC\",className:\"form-control mt-1\",value:tempData.code,onChange:handleChange})]})})]}),/*#__PURE__*/_jsxs(\"label\",{className:\"form-check-label\",htmlFor:\"is_enabled\",children:[/*#__PURE__*/_jsx(\"input\",{className:\"form-check-input me-2\",type:\"checkbox\",id:\"is_enabled\",name:\"is_enabled\",checked:!!tempData.is_enabled,onChange:handleChange}),\"\\u662F\\u5426\\u555F\\u7528\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"modal-footer\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-secondary\",onClick:closeModal,children:\"\\u95DC\\u9589\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn btn-primary\",onClick:submit,children:\"\\u5132\\u5B58\"})]})]})})});}export default ProductModal;","map":{"version":3,"names":["axios","useEffect","useState","useContext","MessageContext","handleSuccessMessage","handleErrorMessage","ProductModal","closeModal","getCoupons","type","tempCoupon","title","is_enabled","percent","due_date","code","tempData","setTempData","Date","date","setDate","dispatch","handleChange","e","target","value","name","includes","Number","checked","submit","api","process","env","REACT_APP_API_PATH","method","id","data","getTime","res","console","log","getFullYear","toString","getMonth","padStart","getDate"],"sources":["C:/Users/A3423/Desktop/Project/react-cra/src/components/CouponModal.js"],"sourcesContent":["import axios from \"axios\";\nimport { useEffect, useState, useContext } from 'react';\nimport {\n  MessageContext,\n  handleSuccessMessage,\n  handleErrorMessage,\n} from '../store/messageStore';\n\nfunction ProductModal({ closeModal, getCoupons, type, tempCoupon }) {\n  const [tempData, setTempData] = useState({\n    title: '',\n    is_enabled: 1,\n    percent: 80,\n    due_date: 1555459200,\n    code: 'testCode',\n  });\n  const [date, setDate] = useState(new Date());\n  const [, dispatch] = useContext(MessageContext);\n\n  useEffect(() => {\n    if (type === 'create') {\n      setTempData({\n        title: '',\n        is_enabled: 1,\n        percent: 80,\n        due_date: 1555459200,\n        code: 'testCode',\n      });\n      setDate(new Date());\n    } else if (type === 'edit') {\n      setTempData(tempCoupon);\n      setDate(new Date(tempCoupon.due_date))\n    }\n  }, [type, tempCoupon]);\n\n  const handleChange = (e) => {\n    const { value, name } = e.target;\n    if (['price', 'origin_price'].includes(name)) {\n      setTempData({\n        ...tempData,\n        [name]: Number(value),\n      });\n    } else if (name === 'is_enabled') {\n      setTempData({\n        ...tempData,\n        [name]: +e.target.checked, // boolean\n      });\n    } else {\n      setTempData({\n        ...tempData,\n        [name]: value,\n      });\n    }\n  };\n\n  const submit = async () => {\n    try {\n      let api = `/v2/api/${process.env.REACT_APP_API_PATH}/admin/coupon`;\n      let method = 'post';\n      if (type === 'edit') {\n        api = `/v2/api/${process.env.REACT_APP_API_PATH}/admin/coupon/${tempCoupon.id}`;\n        method = 'put';\n      }\n      const res = await axios[method](\n        api,\n        {\n          data: {\n            ...tempData,\n            due_date: date.getTime(), // 轉換成 unix timestamp\n          },\n        },\n      );\n      console.log(res);\n      handleSuccessMessage(dispatch, res);\n      closeModal();\n      getCoupons();\n    } catch (error) {\n      console.log(error);\n      handleErrorMessage(dispatch, error);\n    }\n  };\n\n  return (\n    <div\n      className='modal fade'\n      tabIndex='-1'\n      id='productModal'\n      aria-labelledby='exampleModalLabel'\n      aria-hidden='true'\n    >\n      <div className='modal-dialog modal-lg'>\n        <div className='modal-content'>\n          <div className='modal-header'>\n            <h1 className='modal-title fs-5' id='exampleModalLabel'>\n              {type === 'create' ? '建立新優惠券' : `編輯 ${tempData.title}`}\n            </h1>\n            <button\n              type='button'\n              className='btn-close'\n              aria-label='Close'\n              onClick={closeModal}\n            />\n          </div>\n          <div className='modal-body'>\n            <div className='mb-2'>\n              <label className='w-100' htmlFor='title'>\n                標題\n                <input\n                  type='text'\n                  id='title'\n                  placeholder='請輸入標題'\n                  name='title'\n                  className='form-control mt-1'\n                  value={tempData.title}\n                  onChange={handleChange}\n                />\n              </label>\n            </div>\n            <div className='row'>\n              <div className='col-md-6 mb-2'>\n                <label className='w-100' htmlFor='percent'>\n                  折扣（%）\n                  <input\n                    type='text'\n                    name='percent'\n                    id='percent'\n                    placeholder='請輸入折扣（%）'\n                    className='form-control mt-1'\n                    value={tempData.percent}\n                    onChange={handleChange}\n                  />\n                </label>\n              </div>\n              <div className='col-md-6 mb-2'>\n                <label className='w-100' htmlFor='due_date'>\n                  到期日\n                  <input\n                    type='date'\n                    id='due_date'\n                    name='due_date'\n                    placeholder='請輸入到期日'\n                    className='form-control mt-1'\n                    value={`${date.getFullYear().toString()}-${(\n                      date.getMonth() + 1\n                    )\n                      .toString()\n                      .padStart(2, 0)}-${date\n                      .getDate()\n                      .toString()\n                      .padStart(2, 0)}`}\n                    onChange={(e) => {\n                      setDate(new Date(e.target.value));\n                    }}\n                  />\n                </label>\n              </div>\n              <div className='col-md-6 mb-2'>\n                <label className='w-100' htmlFor='code'>\n                  優惠碼\n                  <input\n                    type='text'\n                    id='code'\n                    name='code'\n                    placeholder='請輸入優惠碼'\n                    className='form-control mt-1'\n                    value={tempData.code}\n                    onChange={handleChange}\n                  />\n                </label>\n              </div>\n            </div>\n            <label className='form-check-label' htmlFor='is_enabled'>\n              <input\n                className='form-check-input me-2'\n                type='checkbox'\n                id='is_enabled'\n                name='is_enabled'\n                checked={!!tempData.is_enabled}\n                onChange={handleChange}\n              />\n              是否啟用\n            </label>\n          </div>\n          <div className='modal-footer'>\n            <button\n              type='button'\n              className='btn btn-secondary'\n              onClick={closeModal}\n            >\n              關閉\n            </button>\n            <button type='button' className='btn btn-primary' onClick={submit}>\n              儲存\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ProductModal;"],"mappings":"uoBAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,OAASC,SAAS,CAAEC,QAAQ,CAAEC,UAAU,KAAQ,OAAO,CACvD,OACEC,cAAc,CACdC,oBAAoB,CACpBC,kBAAkB,KACb,uBAAuB,CAAC,wFAE/B,QAASC,aAAY,MAA+C,IAA5CC,WAAU,MAAVA,UAAU,CAAEC,UAAU,MAAVA,UAAU,CAAEC,IAAI,MAAJA,IAAI,CAAEC,UAAU,MAAVA,UAAU,CAC9D,cAAgCT,QAAQ,CAAC,CACvCU,KAAK,CAAE,EAAE,CACTC,UAAU,CAAE,CAAC,CACbC,OAAO,CAAE,EAAE,CACXC,QAAQ,CAAE,UAAU,CACpBC,IAAI,CAAE,UACR,CAAC,CAAC,wCANKC,QAAQ,eAAEC,WAAW,eAO5B,eAAwBhB,QAAQ,CAAC,GAAIiB,KAAI,EAAE,CAAC,yCAArCC,IAAI,eAAEC,OAAO,eACpB,gBAAqBlB,UAAU,CAACC,cAAc,CAAC,4CAAtCkB,QAAQ,iBAEjBrB,SAAS,CAAC,UAAM,CACd,GAAIS,IAAI,GAAK,QAAQ,CAAE,CACrBQ,WAAW,CAAC,CACVN,KAAK,CAAE,EAAE,CACTC,UAAU,CAAE,CAAC,CACbC,OAAO,CAAE,EAAE,CACXC,QAAQ,CAAE,UAAU,CACpBC,IAAI,CAAE,UACR,CAAC,CAAC,CACFK,OAAO,CAAC,GAAIF,KAAI,EAAE,CAAC,CACrB,CAAC,IAAM,IAAIT,IAAI,GAAK,MAAM,CAAE,CAC1BQ,WAAW,CAACP,UAAU,CAAC,CACvBU,OAAO,CAAC,GAAIF,KAAI,CAACR,UAAU,CAACI,QAAQ,CAAC,CAAC,CACxC,CACF,CAAC,CAAE,CAACL,IAAI,CAAEC,UAAU,CAAC,CAAC,CAEtB,GAAMY,aAAY,CAAG,QAAfA,aAAY,CAAIC,CAAC,CAAK,CAC1B,cAAwBA,CAAC,CAACC,MAAM,CAAxBC,KAAK,WAALA,KAAK,CAAEC,IAAI,WAAJA,IAAI,CACnB,GAAI,CAAC,OAAO,CAAE,cAAc,CAAC,CAACC,QAAQ,CAACD,IAAI,CAAC,CAAE,CAC5CT,WAAW,gCACND,QAAQ,wBACVU,IAAI,CAAGE,MAAM,CAACH,KAAK,CAAC,GACrB,CACJ,CAAC,IAAM,IAAIC,IAAI,GAAK,YAAY,CAAE,CAChCT,WAAW,gCACND,QAAQ,wBACVU,IAAI,CAAG,CAACH,CAAC,CAACC,MAAM,CAACK,OAAO,GACzB,CACJ,CAAC,IAAM,CACLZ,WAAW,gCACND,QAAQ,wBACVU,IAAI,CAAGD,KAAK,GACb,CACJ,CACF,CAAC,CAED,GAAMK,OAAM,6FAAG,uKAEPC,GAAG,mBAAcC,OAAO,CAACC,GAAG,CAACC,kBAAkB,kBAC/CC,MAAM,CAAG,MAAM,CACnB,GAAI1B,IAAI,GAAK,MAAM,CAAE,CACnBsB,GAAG,mBAAcC,OAAO,CAACC,GAAG,CAACC,kBAAkB,0BAAiBxB,UAAU,CAAC0B,EAAE,CAAE,CAC/ED,MAAM,CAAG,KAAK,CAChB,CAAC,sBACiBpC,MAAK,CAACoC,MAAM,CAAC,CAC7BJ,GAAG,CACH,CACEM,IAAI,gCACCrB,QAAQ,MACXF,QAAQ,CAAEK,IAAI,CAACmB,OAAO,EAAI;AAAA,EAE9B,CAAC,CACF,QARKC,GAAG,eASTC,OAAO,CAACC,GAAG,CAACF,GAAG,CAAC,CAChBnC,oBAAoB,CAACiB,QAAQ,CAAEkB,GAAG,CAAC,CACnChC,UAAU,EAAE,CACZC,UAAU,EAAE,CAAC,iFAEbgC,OAAO,CAACC,GAAG,aAAO,CAClBpC,kBAAkB,CAACgB,QAAQ,aAAQ,CAAC,oEAEvC,kBAzBKS,OAAM,2CAyBX,CAED,mBACE,YACE,SAAS,CAAC,YAAY,CACtB,QAAQ,CAAC,IAAI,CACb,EAAE,CAAC,cAAc,CACjB,kBAAgB,mBAAmB,CACnC,cAAY,MAAM,uBAElB,YAAK,SAAS,CAAC,uBAAuB,uBACpC,aAAK,SAAS,CAAC,eAAe,wBAC5B,aAAK,SAAS,CAAC,cAAc,wBAC3B,WAAI,SAAS,CAAC,kBAAkB,CAAC,EAAE,CAAC,mBAAmB,UACpDrB,IAAI,GAAK,QAAQ,CAAG,QAAQ,wBAASO,QAAQ,CAACL,KAAK,CAAE,EACnD,cACL,eACE,IAAI,CAAC,QAAQ,CACb,SAAS,CAAC,WAAW,CACrB,aAAW,OAAO,CAClB,OAAO,CAAEJ,UAAW,EACpB,GACE,cACN,aAAK,SAAS,CAAC,YAAY,wBACzB,YAAK,SAAS,CAAC,MAAM,uBACnB,eAAO,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,WAAC,cAEvC,4BACE,IAAI,CAAC,MAAM,CACX,EAAE,CAAC,OAAO,CACV,WAAW,CAAC,gCAAO,CACnB,IAAI,CAAC,OAAO,CACZ,SAAS,CAAC,mBAAmB,CAC7B,KAAK,CAAES,QAAQ,CAACL,KAAM,CACtB,QAAQ,CAAEW,YAAa,EACvB,GACI,EACJ,cACN,aAAK,SAAS,CAAC,KAAK,wBAClB,YAAK,SAAS,CAAC,eAAe,uBAC5B,eAAO,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,WAAC,2BAEzC,4BACE,IAAI,CAAC,MAAM,CACX,IAAI,CAAC,SAAS,CACd,EAAE,CAAC,SAAS,CACZ,WAAW,CAAC,6CAAU,CACtB,SAAS,CAAC,mBAAmB,CAC7B,KAAK,CAAEN,QAAQ,CAACH,OAAQ,CACxB,QAAQ,CAAES,YAAa,EACvB,GACI,EACJ,cACN,YAAK,SAAS,CAAC,eAAe,uBAC5B,eAAO,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,WAAC,oBAE1C,4BACE,IAAI,CAAC,MAAM,CACX,EAAE,CAAC,UAAU,CACb,IAAI,CAAC,UAAU,CACf,WAAW,CAAC,sCAAQ,CACpB,SAAS,CAAC,mBAAmB,CAC7B,KAAK,WAAKH,IAAI,CAACuB,WAAW,EAAE,CAACC,QAAQ,EAAE,aAAI,CACzCxB,IAAI,CAACyB,QAAQ,EAAE,CAAG,CAAC,EAElBD,QAAQ,EAAE,CACVE,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAC,aAAI1B,IAAI,CACtB2B,OAAO,EAAE,CACTH,QAAQ,EAAE,CACVE,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAC,CAAG,CACpB,QAAQ,CAAE,kBAACtB,CAAC,CAAK,CACfH,OAAO,CAAC,GAAIF,KAAI,CAACK,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC,CACnC,CAAE,EACF,GACI,EACJ,cACN,YAAK,SAAS,CAAC,eAAe,uBAC5B,eAAO,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,WAAC,oBAEtC,4BACE,IAAI,CAAC,MAAM,CACX,EAAE,CAAC,MAAM,CACT,IAAI,CAAC,MAAM,CACX,WAAW,CAAC,sCAAQ,CACpB,SAAS,CAAC,mBAAmB,CAC7B,KAAK,CAAET,QAAQ,CAACD,IAAK,CACrB,QAAQ,CAAEO,YAAa,EACvB,GACI,EACJ,GACF,cACN,eAAO,SAAS,CAAC,kBAAkB,CAAC,OAAO,CAAC,YAAY,wBACtD,cACE,SAAS,CAAC,uBAAuB,CACjC,IAAI,CAAC,UAAU,CACf,EAAE,CAAC,YAAY,CACf,IAAI,CAAC,YAAY,CACjB,OAAO,CAAE,CAAC,CAACN,QAAQ,CAACJ,UAAW,CAC/B,QAAQ,CAAEU,YAAa,EACvB,2BAEJ,GAAQ,GACJ,cACN,aAAK,SAAS,CAAC,cAAc,wBAC3B,eACE,IAAI,CAAC,QAAQ,CACb,SAAS,CAAC,mBAAmB,CAC7B,OAAO,CAAEf,UAAW,UACrB,cAED,EAAS,cACT,eAAQ,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,iBAAiB,CAAC,OAAO,CAAEuB,MAAO,UAAC,cAEnE,EAAS,GACL,GACF,EACF,EACF,CAEV,CAEA,cAAexB,aAAY"},"metadata":{},"sourceType":"module","externalDependencies":[]}